{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/until.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["import { observer } from \".\"\r\n\r\n// 拿到数组原型上的方法\r\nlet oldArrayProtoMethods = Array.prototype\r\n\r\n// 继承 arrayMrthods.__proto__ = oldArrayProtoMethods\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reserve',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  arrayMethods[method] = function (...arg) {\r\n    const result = oldArrayProtoMethods[method].apply(this, arg)  // ?\r\n    let inserted\r\n    let ob = this.__ob__\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift': // 都是追加，需要继续检测\r\n        inserted = arg\r\n        break;\r\n\r\n      case 'splice': //vue.$set原理\r\n        inserted = arg.slice(2)\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    if (inserted) ob.observerArray(inserted)\r\n\r\n    return result\r\n  }\r\n})\r\n","export function proxy(vm, data, key) {\r\n  Object.defineProperty(vm, data, {\r\n    get() {\r\n      return vm[data][key]\r\n    },\r\n    set(newValue) {\r\n      vm[data][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\nexport function defineProperty(target, key, value) {\r\n  Object.defineProperty(target, key, {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value\r\n  })\r\n}","import { arrayMethods } from './array'\r\nimport { defineProperty } from '../until'\r\nclass Observer {\r\n  constructor(value) {\r\n\r\n    // 判断一个对象是否被观测过，看有没有__ob__\r\n    defineProperty(value, '__ob__', this)\r\n\r\n    // 使用defineProperty重新定义树形\r\n    if (Array.isArray(value)) {\r\n      //函数劫持、切片编程 \r\n      value.__proto__ = arrayMethods\r\n\r\n      // 观测数组中的对象类型，对象变化也要做处理\r\n      this.observerArray(value)\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n\r\n  observerArray(value) {\r\n    value.forEach(item => {\r\n      observer(item)\r\n    })\r\n  }\r\n\r\n  walk(data) {\r\n    let keys = Object.keys(data) //获取对象的key\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n  observer(value) //如果值是对象，继续观测。对象套对象，递归检测\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return\r\n      observer(newValue) // 设置值是对象，继续观测\r\n      value = newValue\r\n    }\r\n  })\r\n}\r\n\r\nexport function observer(data) {\r\n  // 不是对象或者是null\r\n  if (typeof data !== 'object' || data === null) {\r\n    return data\r\n  }\r\n\r\n  if (data.__ob__) { // ？为什么可能被重复观测\r\n    return data\r\n  }\r\n  return new Observer(data)\r\n}","import { observer } from \"./observer/index\"\r\nimport { proxy } from './until'\r\nexport function initState(vm) {\r\n  const options = vm.$options\r\n\r\n  if (options.props) {\r\n    initProps(vm)\r\n  }\r\n\r\n  if (options.methods) {\r\n    initMethods(vm)\r\n  }\r\n\r\n  if (options.data) {\r\n    initData(vm)\r\n  }\r\n\r\n  if (options.computed) {\r\n    initComputed(vm)\r\n  }\r\n\r\n  if (options.watch) {\r\n    initWatch(vm)\r\n  }\r\n}\r\n\r\nfunction initProps() { }\r\nfunction initMethods() { }\r\n\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n  // 去vm上取值，代理到_data上\r\n  for (const key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n\r\n  // 数据劫持，对象Object.defineProperty\r\n  observer(data)\r\n\r\n}\r\nfunction initComputed() { }\r\nfunction initWatch() { }","import { initState } from './state'\r\nexport function initMixin(Vue) {\r\n\r\n  Vue.prototype._init = function (options) {\r\n\r\n    const vm = this\r\n    vm.$options = options\r\n\r\n    // 响应式数据原理\r\n\r\n    //初始化状态(data、props、watch、computed)，将数据初始化劫持，改变数据更新视图\r\n    initState(vm)\r\n\r\n\r\n\r\n    // Vue是个什么框架，借鉴MVVM\r\n    // MVVM:数据变化视图会更新，视图变化数据会被影响，不能替你跳过数据去更新视图\r\n    // ****要看下官网文档这块\r\n  }\r\n}","import { initMixin } from './init'\r\nfunction Vue(options) {\r\n  this._init(options); // 入口，初始化\r\n\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","arg","result","apply","inserted","ob","__ob__","slice","observerArray","proxy","vm","data","key","defineProperty","get","set","newValue","target","value","enumerable","configurable","Observer","isArray","__proto__","walk","item","observer","keys","defineReactive","initState","options","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init"],"mappings":"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"}